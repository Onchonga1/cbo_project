{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>Dashboard</h2>
    
    {% if user.is_superuser %}
    <div class="alert alert-info">
        <h4>Admin Dashboard</h4>
        <p>Total Media Files: {{ total_uploads }}</p>
    </div>
    {% else %}
    <div class="alert alert-info">
        <h4>Your Dashboard</h4>
        <p>Your Media Files: {{ total_uploads }}</p>
    </div>
    {% endif %}
    
    <div class="row mt-4">
        <div class="col-md-12">
            <h3>Media Files</h3>
            {% if media_files %}
            <div class="row">
                {% for media in media_files %}
                <div class="col-md-4 mb-4">
                    <div class="card">
                        {% if media.is_image %}
                            <img src="{{ media.file.url }}" class="card-img-top" alt="{{ media.title }}" style="height: 200px; object-fit: cover;">
                        {% elif media.is_video %}
                            <video class="card-img-top" style="height: 200px; object-fit: cover;" controls>
                                <source src="{{ media.file.url }}" type="video/{{ media.file_extension }}">
                                Your browser does not support the video tag.
                            </video>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ media.title|default:"Untitled" }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <small class="text-muted">
                                Type: {{ media.get_media_type_display }}<br>
                                Uploaded: {{ media.uploaded_at|date:"M d, Y" }}
                            </small>
                            <br>
                            <form method="post" action="{% url 'delete_media' media.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm mt-2" onclick="return confirm('Are you sure you want to delete this file?');">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-warning">
                <p>No media files uploaded yet.</p>
                <a href="{% url 'upload' %}" class="btn btn-primary">Upload Your First File</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
